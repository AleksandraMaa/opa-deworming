\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Ligatures=TeX,Scale=MatchLowercase}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{%
\usepackage{microtype}
\UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\usepackage[margin=1in]{geometry}
\usepackage{hyperref}
\hypersetup{unicode=true,
            pdftitle={Dynamic Document for Fiscal Impacts of Deworming},
            pdfborder={0 0 0},
            breaklinks=true}
\urlstyle{same}  % don't use monospace font for urls
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{graphicx,grffile}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\IfFileExists{parskip.sty}{%
\usepackage{parskip}
}{% else
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{0}
% Redefines (sub)paragraphs to behave more like sections
\ifx\paragraph\undefined\else
\let\oldparagraph\paragraph
\renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
\let\oldsubparagraph\subparagraph
\renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

%%% Use protect on footnotes to avoid problems with footnotes in titles
\let\rmarkdownfootnote\footnote%
\def\footnote{\protect\rmarkdownfootnote}

%%% Change title format to be more compact
\usepackage{titling}

% Create subtitle command for use in maketitle
\newcommand{\subtitle}[1]{
  \posttitle{
    \begin{center}\large#1\end{center}
    }
}

\setlength{\droptitle}{-2em}

  \title{Dynamic Document for Fiscal Impacts of Deworming}
    \pretitle{\vspace{\droptitle}\centering\huge}
  \posttitle{\par}
    \author{}
    \preauthor{}\postauthor{}
    \date{}
    \predate{}\postdate{}
  

\begin{document}
\maketitle

\def\blue{\color{blue}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#starting point is}
\CommentTok{# Calcs-Table 5!N21 =}
\CommentTok{# 'Assumps&Panel A Calcs'!$B$135 * 'Assumps&Panel A Calcs'!$B$10 * }
\CommentTok{# 'Model Params&Exp Profiles'!R9 * 'Model Params&Exp Profiles'!R8}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{## Data }
\NormalTok{gov_bonds <-}\StringTok{    }\FloatTok{0.1185}            \CommentTok{#Kenyan interest on sovereign debt - Central Bank of Kenya}
\NormalTok{inflation <-}\StringTok{  }\FloatTok{0.02}              \CommentTok{#Kenyan inflation rate - World Bank Development Indicators}
\NormalTok{wage_ag_val <-}\StringTok{  }\FloatTok{11.84}             \CommentTok{#Mean hourly wage rate (KSH) - Suri 2011 }
\NormalTok{wage_ww_val <-}\StringTok{  }\FloatTok{14.5850933}      \CommentTok{#Control group hourly wage, ww (cond >=10 hrs per week) - Table 4, Panel B}
\NormalTok{profits_se_val <-}\StringTok{ }\DecValTok{1766}          \CommentTok{#Control group monthly self-employed profits - Table 4, Panel A}
\NormalTok{hours_se_cond_val <-}\StringTok{ }\FloatTok{38.1}       \CommentTok{#Control group weekly self-employed hours, conditional on hrs >0 - Table D13, Panel D}
\NormalTok{hours_ag_val <-}\StringTok{ }\FloatTok{8.3}             \CommentTok{#Control group hrs per week, agriculture - Table 4, Panel D}
\NormalTok{hours_ww_val <-}\StringTok{ }\FloatTok{6.9}             \CommentTok{#Control group hrs per week, working for wages - Table 4, Panel B}
\NormalTok{hours_se_val <-}\StringTok{ }\FloatTok{3.3}             \CommentTok{#Control group hrs per week, self-employment - Table 4, Panel A}
\NormalTok{ex_rate_val <-}\StringTok{ }\DecValTok{85}               \CommentTok{#Exchange Rate - Central Bank of Kenya }
\NormalTok{growth_rate_val <-}\StringTok{ }\FloatTok{1.52}\OperatorTok{/}\DecValTok{100}     \CommentTok{#Per-capita GDP growth, 2002-2011 (accessed 1/29/13) -  World Bank - see notes}
\NormalTok{coverage_val  <-}\StringTok{ }\FloatTok{0.681333333}    \CommentTok{#Fraction of treated primary school students within 6 km - from W@W - see note}
\NormalTok{saturation_val <-}\StringTok{  }\FloatTok{0.511}        \CommentTok{#Overall Saturation - not reported in table, average of T & C}
\NormalTok{full_saturation_val <-}\StringTok{ }\FloatTok{0.75}     \CommentTok{#REPEATED WITH q_full_val in Research component}
\NormalTok{tax_val <-}\StringTok{ }\FloatTok{0.16575}              \CommentTok{#ADD INFO}
\NormalTok{unit_cost_local_val <-}\StringTok{ }\FloatTok{43.66}    \CommentTok{#Deworm the World}
\NormalTok{years_of_treat_val <-}\StringTok{ }\FloatTok{2.41}      \CommentTok{#Additional Years of Treatment - Table 1, Panel A}
    
    
\CommentTok{## Research   }
\NormalTok{lambda1_vals <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\FloatTok{3.49}\NormalTok{, }\DecValTok{0}\NormalTok{)      }\CommentTok{#Hrs per week increase for men and women CONFIRM}
\NormalTok{lambda2_val <-}\StringTok{ }\FloatTok{10.2}             \CommentTok{#Externality effect (proportional) - Table 3, Panel B}
\NormalTok{q_full_val <-}\StringTok{ }\FloatTok{0.75}              \CommentTok{#Take up rates with full subsidy. From Miguel and Kremmer (2007)}
    
\CommentTok{## Guess work   }
\NormalTok{periods_val <-}\StringTok{ }\DecValTok{50}               \CommentTok{#Total number of periods to forecast wages}
\NormalTok{time_to_jm_val <-}\StringTok{ }\DecValTok{10}            \CommentTok{#Time from intial period until individual join the labor force}
\NormalTok{coef_exp_val <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{0}\NormalTok{)         }\CommentTok{#Years of experience coefficients (1-linear, 2-cuadratic)   - see notes }
\NormalTok{teach_sal_val <-}\StringTok{ }\DecValTok{5041}           \CommentTok{#Yearly secondary schooling compensation    5041 - from ROI materials}
\NormalTok{teach_ben_val <-}\StringTok{ }\FloatTok{217.47}         \CommentTok{#Yearly secondary schooling teacher benefits    217.47}
\NormalTok{n_students_val <-}\StringTok{ }\DecValTok{45}            \CommentTok{#Average pupils per teacher 45}


\CommentTok{# (Delta E) Additional direct seconday schooling increase (from Joan)   }
\NormalTok{delta_ed_vals <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\FloatTok{0.00176350949079451}\NormalTok{, }\FloatTok{0.00696052250263997}\NormalTok{, }\FloatTok{0.0258570306763183}\NormalTok{, }
  \FloatTok{0.0239963665555466}\NormalTok{, }\FloatTok{0.027301406306074}\NormalTok{, }\FloatTok{0.0234125454594173}\NormalTok{, }\FloatTok{0.0279278879439199}\NormalTok{, }
  \FloatTok{0.00647044449446303}\NormalTok{, }\FloatTok{0.00835739437790601}\NormalTok{)                                     }
\NormalTok{delta_ed_vals <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(delta_ed_vals, }\DecValTok{1999}\OperatorTok{:}\DecValTok{2007}\NormalTok{)}

\CommentTok{#Additional externality secondary schooling increase (from Joan)}
\NormalTok{delta_ed_ext_vals <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\FloatTok{0.0110126908021048}\NormalTok{, }\FloatTok{0.0140448546741008}\NormalTok{, }\FloatTok{-0.0034636291545585}\NormalTok{,}
                       \FloatTok{0.0112940214439477}\NormalTok{,  }\FloatTok{0.0571608179771775}\NormalTok{, }\FloatTok{-0.0560546793186931}\NormalTok{,}
                       \FloatTok{0.0558284756343451}\NormalTok{,  }\FloatTok{0.1546264843901160}\NormalTok{, }\FloatTok{0.0055961489945619}\NormalTok{)}
\NormalTok{delta_ed_ext_vals <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(delta_ed_ext_vals, }\DecValTok{1999}\OperatorTok{:}\DecValTok{2007}\NormalTok{)}

\CommentTok{#Notes: }
\CommentTok{# on growth_rate_val: (http://data.worldbank.org/indicator/NY.GDP.PCAP.KD/), see calculation on "Kenya GDP per capita" tab. In W@W this equals 1.52%. ISSUE: This growth number should be updated to be 2002-2014, I think.}
\CommentTok{# on coef_exp_val: 1998/1999 Kenyan labor force survey; regression of earnings on age, age^2, female dummy, indicators for attained primary/secondary/beyond, and province dummies. Estimate used in W@W: (0.1019575, -0.0010413). ISSUE: For now assume no further life cycle adjustment beyond KLPS-3 (likely a conservative assumption).}
\CommentTok{# coverage_val: Overall Saturation (0.511) / 0.75 - not reported in table, average of T & C}
\end{Highlighting}
\end{Shaded}

\hypertarget{who-are-the-policy-makers}{%
\subsection{Who are the policy
makers?}\label{who-are-the-policy-makers}}

\begin{itemize}
\tightlist
\item
  Ministries of Health, Education and Finance.
\end{itemize}

\hypertarget{what-is-the-relevant-output-that-should-be-used-to-inform-them}{%
\subsection{What is the relevant output that should be used to inform
them?}\label{what-is-the-relevant-output-that-should-be-used-to-inform-them}}

\begin{itemize}
\tightlist
\item
  NPV
\end{itemize}

\hypertarget{proposed-output}{%
\subsection{Proposed output:}\label{proposed-output}}

\includegraphics{01_test_dd_files/figure-latex/sample-output-1.pdf}

\hypertarget{main-equation-the-model}{%
\subsection{Main Equation (the model)}\label{main-equation-the-model}}

\begin{equation}
NPV =  \sum_{\gamma} N_{\gamma} \left[ 
\tau \sum_{t=0}^{50} \left( \frac{1}{1 + r}\right)^{t} w_{t} 
\left( \lambda_{1, \gamma} + \frac{p \lambda_{2, \gamma}}{R} \right) - 
K \sum_{t=0}^{50} \left( \frac{1}{1 + r}\right)^{t} \Delta \overline{E}_{\gamma t}(S1,S2)
\right] - \left( S_{2}Q(S_{2}) - S_{1}Q(S_{1}) \right)
\label{eq:1}
\tag{1}
\end{equation}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Gamma is used to index gender. }
\NormalTok{npv <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(}\DataTypeTok{n_male=}\DecValTok{1}\OperatorTok{/}\DecValTok{2}\NormalTok{, }\DataTypeTok{n_female=}\DecValTok{1}\OperatorTok{/}\DecValTok{2}\NormalTok{, }
                \DataTypeTok{interest_r=}\NormalTok{interst_r_val, }
                \DataTypeTok{wage=}\NormalTok{wage_t_val, }
                \DataTypeTok{lambda1_male=}\NormalTok{lambda1_vals[}\DecValTok{1}\NormalTok{],}
                \DataTypeTok{lambda1_female=}\NormalTok{lambda1_vals[}\DecValTok{2}\NormalTok{], }
                \DataTypeTok{tax=}\NormalTok{tax_val, }
                \DataTypeTok{saturation=}\NormalTok{saturation_val, }
                \DataTypeTok{coverage=}\NormalTok{coverage_val, }
                \DataTypeTok{cost_of_schooling=}\NormalTok{cost_per_student, }
                \DataTypeTok{delta_ed_male=}\NormalTok{delta_ed_vals[,}\DecValTok{1}\NormalTok{], }
                \DataTypeTok{delta_ed_female=}\NormalTok{delta_ed_vals[,}\DecValTok{1}\NormalTok{], }
                \DataTypeTok{lambda2_male=}\NormalTok{lambda2_vals[}\DecValTok{1}\NormalTok{], }
                \DataTypeTok{lambda2_female=}\NormalTok{lambda2_vals[}\DecValTok{2}\NormalTok{], }
                \DataTypeTok{s1=}\DecValTok{0}\NormalTok{, }\DataTypeTok{q1=}\DecValTok{0}\NormalTok{, }\DataTypeTok{s2=}\NormalTok{s2_val, }\DataTypeTok{q2=}\NormalTok{q2_val, }
                \DataTypeTok{periods=}\NormalTok{periods_val) \{}
\NormalTok{  ns <-}\StringTok{ }\KeywordTok{c}\NormalTok{(n_male, n_female)}
\NormalTok{  lambda1s <-}\StringTok{ }\KeywordTok{c}\NormalTok{(lambda1_male, lambda1_female)}
\NormalTok{  lambda2s <-}\StringTok{ }\KeywordTok{c}\NormalTok{(lambda2_male, lambda2_female)}
\NormalTok{  index_t <-}\StringTok{ }\DecValTok{0}\OperatorTok{:}\NormalTok{periods}
\NormalTok{  delta_ed_s <-}\StringTok{ }\KeywordTok{cbind}\NormalTok{(delta_ed_male, delta_ed_female) }
\NormalTok{  delta_ed_s <-}\StringTok{ }\KeywordTok{rbind}\NormalTok{(}\KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{), delta_ed_s, }\KeywordTok{matrix}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{41}\NormalTok{, }\DecValTok{2}\NormalTok{) ) }
  
\NormalTok{  benef <-}\StringTok{ }\KeywordTok{matrix}\NormalTok{(}\OtherTok{NA}\NormalTok{, }\DecValTok{51}\NormalTok{,}\DecValTok{2}\NormalTok{)}
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\DecValTok{2}\NormalTok{)\{}
\NormalTok{  benef[,i] <-}\StringTok{ }\NormalTok{( }\DecValTok{1} \OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{interest_r) )}\OperatorTok{^}\NormalTok{index_t }\OperatorTok{*}\StringTok{ }\NormalTok{wage }\OperatorTok{*}\StringTok{ }
\StringTok{                     }\NormalTok{( lambda1s[i] }\OperatorTok{+}\StringTok{ }\NormalTok{saturation }\OperatorTok{*}\StringTok{ }\NormalTok{lambda2s[i] }\OperatorTok{/}\StringTok{ }\NormalTok{coverage ) }
\NormalTok{  \}}
  
\NormalTok{  res1 <-}\StringTok{ }\KeywordTok{sum}\NormalTok{( ns }\OperatorTok{*}\StringTok{ }\NormalTok{( tax }\OperatorTok{*}\StringTok{ }\KeywordTok{apply}\NormalTok{(benef, }\DecValTok{2}\NormalTok{, sum) }\OperatorTok{-}\StringTok{ }
\StringTok{            }\KeywordTok{apply}\NormalTok{( ( }\DecValTok{1} \OperatorTok{/}\StringTok{ }\NormalTok{(}\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{interest_r) )}\OperatorTok{^}\NormalTok{index_t }\OperatorTok{*}\StringTok{ }
\StringTok{                     }\NormalTok{delta_ed_s }\OperatorTok{*}\StringTok{ }\NormalTok{cost_of_schooling, }\DecValTok{2}\NormalTok{, sum) )}
\NormalTok{          ) }\OperatorTok{-}\StringTok{ }\NormalTok{(s2 }\OperatorTok{*}\StringTok{ }\NormalTok{q2  }\OperatorTok{-}\StringTok{ }\NormalTok{s1 }\OperatorTok{*}\StringTok{ }\NormalTok{q1) }
\CommentTok{#  browser()}
  \KeywordTok{return}\NormalTok{(res1)  }
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{sub-components}{%
\subsection{Sub components:}\label{sub-components}}

\hypertarget{r}{%
\subsubsection{\texorpdfstring{1 - ``\(r\)''}{1 - ``r''}}\label{r}}

\begin{equation}
NPV =  \sum_{\gamma} N_{\gamma} \left[ 
\tau \sum_{t=0}^{50} \color{blue}{\left(  \frac{1}{1 + r}\right)}^{t} w_{t} 
\left( \lambda_{1, \gamma} + \frac{p \lambda_{2, \gamma}}{R} \right) - 
K \sum_{t=0}^{50} \color{blue}{\left( \frac{1}{1 + r}\right)}^{t} \Delta \overline{E}_{\gamma t}(S1,S2)
\right] - \left( S_{2}Q(S_{2}) - S_{1}Q(S_{1}) \right)
\end{equation}

The real interest rate \(r\) is obtained from the interest rate on
goberment bonds (0.118) minus the inflation rate (0.02).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{interst_r_val <-}\StringTok{ }\NormalTok{gov_bonds }\OperatorTok{-}\StringTok{ }\NormalTok{inflation}
\end{Highlighting}
\end{Shaded}

\hypertarget{w_t}{%
\subsubsection{\texorpdfstring{2 -
``\(w_{t}\)''}{2 - ``w\_\{t\}''}}\label{w_t}}

\begin{equation}
NPV =  \sum_{\gamma} N_{\gamma} \left[ 
\tau \sum_{t=0}^{50}\left(  \frac{1}{1 + r}\right)^{t} \color{blue}{ w_{t} }
\left( \lambda_{1, \gamma} + \frac{p \lambda_{2, \gamma}}{R} \right) - 
K \sum_{t=0}^{50} \left( \frac{1}{1 + r}\right)^{t} \Delta \overline{E}_{\gamma t}(S1,S2)
\right] - \left( S_{2}Q(S_{2}) - S_{1}Q(S_{1}) \right)
\end{equation}

\begin{equation}
w_t =  \text{#weeks} \times w_0 (1 + g)^{Xp}(1 + \hat{\beta_1} Xp + \hat{\beta_2} Xp^2) \quad \text{for } t=10, \dots, 50
\end{equation}

ndividual in the data are assumed to enter the labor force 10 years
after the (data) present day (\(w_t = 0\) for \(t<10\)). Wage at time
\(t\) is the weekely starting wage in USD (\(w_0\)) that has a base
growth rate equal to the per capita GDP growth (\(g\)) applied to
however many years of work (\(Xp\)). In addition to this growth, the
salaries are adjusted to represent a (concave) wage life cycle profile
(\(1 + \hat{\beta_1} Xp + \hat{\beta_2} Xp^2\)).

\hypertarget{w_0}{%
\paragraph{\texorpdfstring{2.1 -
``\(w_0\)''}{2.1 - ``w\_0''}}\label{w_0}}

\begin{equation}
w_t =  \text{#weeks} \times \color{blue}{w_0} (1 + g)^{Xp}(1 + \hat{\beta_1} Xp + \hat{\beta_2} Xp^2)
\end{equation}

\begin{equation}
w_0 = \frac{1}{ex} \sum_{l \in \{ag, ww, se\}}w_{l}\alpha_{l} \\ \quad \text{with: } \alpha_{l}= \frac{ h_{l}}{h_{ag} + h_{ww} + h_{se}}  
\end{equation}

The initial wage in dollars (\(w_{0}\)) is a weighted average of wages
for control group in agriculture, working wage, and self-employed
sectors (\(ag, ww, se\)). The weights correspond to the average number
of hours in each sector (\(h_l\)) relative to the sum of the average
number of hours in each sector.

The wage in agriculture comes from research (Suri, 2011), the working
wage comes from the data and its defined as hourly wage for the control
group for those who reported more than 10 hrs of work per week. The
self-employed wage (\(w_{se}\)) was constructed as follows:

\begin{equation}
w_{se} =  \frac{ \text{Monthly self-employed profits} }{4.5 \times E[h_{se}|h_{se}>0] }
\end{equation}

Where both parameters (Monthly self-employed profits and self-employed
hours for the control group, conditional on hrs \textgreater{}0 -
\(E[h_{se}|h_{se}>0]\) -) come from the data (ww paper).

\begin{itemize}
\item
  \textbf{Question}: hrs ag = Assumps\&Panel A Calcs B25 - still not
  sure how it came from table 4 (no panel D and )
\item
  \textbf{Question}: explain diff betwee \(E[h_{se}|h_{se}>0]\) and
  \(h_{se}\) (why used differently)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{wage_}\DecValTok{0}\NormalTok{_f <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(}\DataTypeTok{wage_ag =}\NormalTok{ wage_ag_val, }
                     \DataTypeTok{wage_ww =}\NormalTok{ wage_ww_val, }
                     \DataTypeTok{profits_se =}\NormalTok{ profits_se_val, }
                     \DataTypeTok{hours_se_cond =}\NormalTok{ hours_se_cond_val, }
                     \DataTypeTok{hours_ag =}\NormalTok{ hours_ag_val, }
                     \DataTypeTok{hours_ww =}\NormalTok{ hours_ww_val, }
                     \DataTypeTok{hours_se =}\NormalTok{ hours_se_val, }
                     \DataTypeTok{ex_rate =}\NormalTok{ ex_rate_val) \{}
\NormalTok{  wage_se <-}\StringTok{ }\NormalTok{profits_se }\OperatorTok{/}\StringTok{ }\NormalTok{(}\FloatTok{4.5} \OperatorTok{*}\StringTok{ }\NormalTok{hours_se_cond)}
\NormalTok{  wage_ls <-}\StringTok{ }\KeywordTok{c}\NormalTok{(wage_ag, wage_ww, wage_se)}
\NormalTok{  alpha_ls <-}\StringTok{ }\KeywordTok{c}\NormalTok{(hours_ag, hours_ww, hours_se) }\OperatorTok{/}\StringTok{ }\KeywordTok{sum}\NormalTok{( }\KeywordTok{c}\NormalTok{(hours_ag, hours_ww, hours_se) )}
\NormalTok{  res1 <-}\StringTok{ }\DecValTok{1}\OperatorTok{/}\NormalTok{ex_rate }\OperatorTok{*}\StringTok{ }\KeywordTok{sum}\NormalTok{( wage_ls }\OperatorTok{*}\StringTok{ }\NormalTok{alpha_ls )}
  \KeywordTok{return}\NormalTok{(res1)}
\NormalTok{\}}

\CommentTok{#close to value from spreadsheet (Assumps&Panel A Calcs!B137 = 0.1481084), }
\CommentTok{#but I suspect diff due to computational precision }

\NormalTok{wage_}\DecValTok{0}\NormalTok{_val <-}\StringTok{ }\KeywordTok{wage_0_f}\NormalTok{()  }

\NormalTok{experience_val <-}\StringTok{ }\DecValTok{0}\OperatorTok{:}\NormalTok{periods_val }\OperatorTok{-}\StringTok{ }\NormalTok{time_to_jm_val}

\NormalTok{wage_t <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(}\DataTypeTok{wage_0 =}\NormalTok{ wage_}\DecValTok{0}\NormalTok{_val, }
                   \DataTypeTok{growth_rate =}\NormalTok{ growth_rate_val, }
                   \DataTypeTok{experience =}\NormalTok{ experience_val, }
                   \DataTypeTok{coef_exp1 =}\NormalTok{ coef_exp_val[}\DecValTok{1}\NormalTok{], }
                   \DataTypeTok{coef_exp2 =}\NormalTok{ coef_exp_val[}\DecValTok{2}\NormalTok{]) \{}
\NormalTok{  res1 <-}\StringTok{ }\DecValTok{52} \OperatorTok{*}\StringTok{ }\NormalTok{wage_}\DecValTok{0} \OperatorTok{*}\NormalTok{( ( }\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{growth_rate )}\OperatorTok{^}\NormalTok{experience ) }\OperatorTok{*}\StringTok{ }
\StringTok{    }\NormalTok{( }\DecValTok{1} \OperatorTok{+}\StringTok{ }\NormalTok{coef_exp1 }\OperatorTok{*}\StringTok{ }\NormalTok{experience }\OperatorTok{+}\StringTok{ }\NormalTok{coef_exp2 }\OperatorTok{*}\StringTok{ }\NormalTok{experience}\OperatorTok{^}\DecValTok{2}\NormalTok{ ) }\OperatorTok{*}\StringTok{ }
\StringTok{    }\KeywordTok{ifelse}\NormalTok{(}\DecValTok{0}\OperatorTok{:}\NormalTok{periods_val }\OperatorTok{>=}\StringTok{ }\NormalTok{time_to_jm_val, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
  \KeywordTok{return}\NormalTok{(res1) }
\NormalTok{\}}

\CommentTok{#close to value from spreadsheet (Calcs-Table 5!N21.. = 7.701634678), }
\CommentTok{#but I suspect diff due to computational precision }
\NormalTok{wage_t_val <-}\StringTok{ }\KeywordTok{wage_t}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{lambda_1gamma-and-lambda_2gamma}{%
\subsubsection{\texorpdfstring{3 - ``\(\lambda_{1,\gamma}\)'' and
``\(\lambda_{2,\gamma}\)''}{3 - ``\textbackslash{}lambda\_\{1,\textbackslash{}gamma\}'' and ``\textbackslash{}lambda\_\{2,\textbackslash{}gamma\}''}}\label{lambda_1gamma-and-lambda_2gamma}}

\begin{equation}
NPV =  \sum_{\gamma} N_{\gamma} \left[ 
\tau \sum_{t=0}^{50}\left(  \frac{1}{1 + r}\right)^{t} w_{t} 
\left(\color{blue}{ \lambda_{1, \gamma} } + \frac{p \color{blue}{\lambda_{2, \gamma}}}{R} \right) - 
K \sum_{t=0}^{50} \left( \frac{1}{1 + r}\right)^{t} \Delta \overline{E}_{\gamma t}(S1,S2)
\right] - \left( S_{2}Q(S_{2}) - S_{1}Q(S_{1}) \right)
\end{equation}

\(\lambda_{1,\gamma}\) represents the estimated impact of deworming on
hours of work for men a womam. This two parameter are combined with a
unwweighted mean:

\begin{equation}
\lambda_{1} = \frac{1}{2} \lambda_{1,male} + \frac{1}{2} \lambda_{1,female} 
\end{equation} Its components come from research (W@W).

\(\lambda_{2,\gamma}\) the estimated externality effect (EXPLAIN) and
comes from research (W@W). Note that this parameter in not estimated by
gender, so we repeat its value two times.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lambda1_vals <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\FloatTok{0.5} \OperatorTok{*}\StringTok{ }\NormalTok{lambda1_vals[}\DecValTok{1}\NormalTok{] }\OperatorTok{+}\StringTok{ }\FloatTok{0.5} \OperatorTok{*}\NormalTok{lambda1_vals[}\DecValTok{2}\NormalTok{], }\DecValTok{2}\NormalTok{)}
\NormalTok{lambda2_vals <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(lambda2_val, }\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{r-and-p}{%
\subsubsection{\texorpdfstring{4 - \(R\) and
\(p\)}{4 - R and p}}\label{r-and-p}}

\begin{equation}
NPV =  \sum_{\gamma} N_{\gamma} \left[ 
\tau \sum_{t=0}^{50}\left(  \frac{1}{1 + r}\right)^{t} w_{t} 
\left( \lambda_{1, \gamma}  + \frac{\color{blue}{p} \lambda_{2, \gamma}}{\color{blue}{R}} \right) - 
K \sum_{t=0}^{50} \left( \frac{1}{1 + r}\right)^{t} \Delta \overline{E}_{\gamma t}(S1,S2)
\right] - \left( S_{2}Q(S_{2}) - S_{1}Q(S_{1}) \right)
\end{equation}

\(R\) is the fraction of treated primary school students within 6 km.
Computed as \begin{equation}
R = \frac{\text{Overall Saturation}  }{Q(full)}
\end{equation}

\(p\) is the saturation of the intervention, defined as:

\begin{equation}
p = Q(full) \times R
\end{equation}

\textbf{Note:} there is a circularity on how parameters are defined
here. Everything depends on Full Saturation (\(Q(full)\)) at the end of
the day.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#R }
\NormalTok{coverage_val <-}\StringTok{  }\NormalTok{saturation_val }\OperatorTok{/}\StringTok{ }\NormalTok{full_saturation_val}
\CommentTok{#p }
\NormalTok{saturation_val <-}\StringTok{ }\NormalTok{full_saturation_val }\OperatorTok{*}\StringTok{ }\NormalTok{coverage_val}
\end{Highlighting}
\end{Shaded}

\hypertarget{k-and-delta-overlinee_gamma-ts1s2}{%
\subsubsection{\texorpdfstring{5 - \(K\) and
\(\Delta \overline{E}_{\gamma t}(S1,S2)\)}{5 - K and \textbackslash{}Delta \textbackslash{}overline\{E\}\_\{\textbackslash{}gamma t\}(S1,S2)}}\label{k-and-delta-overlinee_gamma-ts1s2}}

\begin{equation}
NPV =  \sum_{\gamma} N_{\gamma} \left[ 
\tau \sum_{t=0}^{50}\left(  \frac{1}{1 + r}\right)^{t} w_{t} 
\left( \lambda_{1, \gamma}  + \frac{p \lambda_{2, \gamma}}{R} \right) - 
\color{blue}{K} \sum_{t=0}^{50} \left( \frac{1}{1 + r}\right)^{t} \color{blue}{ \Delta \overline{E}_{\gamma t}(S1,S2) }
\right] - \left( S_{2}Q(S_{2}) - S_{1}Q(S_{1}) \right)
\end{equation}

\(K\) represents the cost per student. This is calculated as the salary
of the teacher plus benefits, divided by the average number of students
per teacher.

\begin{equation}
K = \frac{\text{teacher salary} + \text{teacher benefits}}{\text{# Students}}
\end{equation}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cost_per_student <-}\StringTok{ }\NormalTok{(teach_sal_val }\OperatorTok{+}\StringTok{ }\NormalTok{teach_ben_val) }\OperatorTok{/}\StringTok{ }\NormalTok{n_students_val}
\end{Highlighting}
\end{Shaded}

For \(\Delta \overline{E}_{\gamma t}(S1,S2)\) we use a series of
estimated effects the additional direct increase in seconday schooling
from 1999 to 2007 obtained from {[}need to define the source ``from
Joan'' in \texttt{Assumps\&Panel\ A\ Calcs!A93}{]}.

This series does not take into account the externality effects. To
incorporate the we need another series (same source) that estimates the
additional secondary schooling increase due to the externality and add
it to the original series.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Nothing here yet with delta_ed_vals, but would like to incorporate model from Joan}
\CommentTok{# delta_ed_vals <- }
\NormalTok{delta_ed_ext_total <-}\StringTok{ }\NormalTok{delta_ed_ext_vals[,}\DecValTok{1}\NormalTok{] }\OperatorTok{+}\StringTok{ }\NormalTok{delta_ed_vals[,}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\textbf{Note:} need to understand better the date of each component (of
the model, not only this section).

\hypertarget{left-s_2qs_2---s_1qs_1-right}{%
\subsubsection{\texorpdfstring{6 -
\(\left( S_{2}Q(S_{2}) - S_{1}Q(S_{1}) \right)\)}{6 - \textbackslash{}left( S\_\{2\}Q(S\_\{2\}) - S\_\{1\}Q(S\_\{1\}) \textbackslash{}right)}}\label{left-s_2qs_2---s_1qs_1-right}}

\begin{equation}
NPV =  \sum_{\gamma} N_{\gamma} \left[ 
\tau \sum_{t=0}^{50}\left(  \frac{1}{1 + r}\right)^{t} w_{t} 
\left( \lambda_{1, \gamma}  + \frac{p \lambda_{2, \gamma}}{R} \right) - 
K \sum_{t=0}^{50} \left( \frac{1}{1 + r}\right)^{t} \Delta \overline{E}_{\gamma t}(S1,S2)
\right] - \color{blue}{ \left( S_{2}Q(S_{2}) - S_{1}Q(S_{1}) \right) }
\end{equation}

\hypertarget{s_1qs_1-0}{%
\paragraph{\texorpdfstring{6.1 -
\(S_{1}Q(S_{1}) = 0\)}{6.1 - S\_\{1\}Q(S\_\{1\}) = 0}}\label{s_1qs_1-0}}

There is no subsidy for deworming under the status quo.

\hypertarget{s_2-complete-subsidy-to-per-capita-costs-of-deworming.}{%
\paragraph{\texorpdfstring{6.2 - \(S_{2}\): complete subsidy to per
capita costs of
deworming.}{6.2 - S\_\{2\}: complete subsidy to per capita costs of deworming.}}\label{s_2-complete-subsidy-to-per-capita-costs-of-deworming.}}

With complete subsidy, \(S_2\) represents the total direct costs of
deworming in USD. Calculated as follows

\begin{equation}
S_{2} = \frac{\text{Cost per person per year (KSH)} }{ex}\times \text{Additional years of treatment} \\ 
\end{equation}

\hypertarget{q_2}{%
\paragraph{\texorpdfstring{6.3 - \(Q_{2}\)}{6.3 - Q\_\{2\}}}\label{q_2}}

The take-up with full subsidy (\(Q_2\)) comes from a previous study
(Miguel and Kremer 2007) and takes the value of 0.75.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s2_val <-}\StringTok{ }\NormalTok{( unit_cost_local_val }\OperatorTok{/}\StringTok{ }\NormalTok{ex_rate_val ) }\OperatorTok{*}\StringTok{ }\NormalTok{years_of_treat_val}
\NormalTok{q2_val <-}\StringTok{ }\NormalTok{q_full_val}
\end{Highlighting}
\end{Shaded}

\hypertarget{main-results}{%
\subsubsection{Main results}\label{main-results}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#no externality NPV}
\NormalTok{res_npv_no_ext <-}\StringTok{ }\KeywordTok{npv}\NormalTok{(}\DataTypeTok{lambda2_male =} \DecValTok{0}\NormalTok{, }\DataTypeTok{lambda2_female =} \DecValTok{0}\NormalTok{)}

\CommentTok{#yes externality NPV}
\NormalTok{res_npv_yes_ext <-}\StringTok{ }\KeywordTok{npv}\NormalTok{(}\DataTypeTok{delta_ed_male =}\NormalTok{ delta_ed_ext_total, }
                       \DataTypeTok{delta_ed_female =}\NormalTok{ delta_ed_ext_total )}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  \textbf{NPV without externalities (\(\lambda_2 = 0\)):} -0.6097
\item
  \textbf{NPV with externalities (\(\lambda_2 = 10.2\) ):} 34.3187
\end{itemize}

\hypertarget{montecarlo-simulations}{%
\subsection{Montecarlo simulations}\label{montecarlo-simulations}}

Describe approach to MC: - Eveything normal with sd= 0.1 * mean\\
- Need to work with experts to add more realistic parameters

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{#34.8401}
\NormalTok{nsims <-}\StringTok{ }\FloatTok{1e4}
\KeywordTok{set.seed}\NormalTok{(}\DecValTok{1234}\NormalTok{)}
\CommentTok{#Defaoult dist: normal, default sd: 0.1* mean}
\CommentTok{## Data }
\NormalTok{gov_bonds_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(}\DataTypeTok{n =}\NormalTok{ nsims, }\DataTypeTok{mean =}\NormalTok{ gov_bonds, }\DataTypeTok{sd =} \FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{gov_bonds)   }
\NormalTok{inflation_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, inflation, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{inflation)}
\NormalTok{wage_ag_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, wage_ag_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{wage_ag_val)}
\NormalTok{wage_ww_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, wage_ww_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{wage_ww_val)}
\NormalTok{profits_se_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, profits_se_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{profits_se_val)}
\NormalTok{hours_se_cond_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, hours_se_cond_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{hours_se_cond_val)}
\NormalTok{hours_ag_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, hours_ag_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{hours_ag_val)}
\NormalTok{hours_ww_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, hours_ww_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{hours_ww_val)}
\NormalTok{hours_se_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, hours_se_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{hours_se_val)}
\NormalTok{ex_rate_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, ex_rate_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{ex_rate_val)}
\NormalTok{growth_rate_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, growth_rate_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{growth_rate_val)}
\NormalTok{coverage_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, coverage_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{coverage_val)}
\NormalTok{saturation_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, saturation_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{saturation_val)}
\NormalTok{full_saturation_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, full_saturation_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{full_saturation_val)}
\NormalTok{tax_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, tax_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{tax_val)}
\NormalTok{unit_cost_local_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, unit_cost_local_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{unit_cost_local_val)}
\NormalTok{years_of_treat_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, years_of_treat_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{years_of_treat_val)}

\CommentTok{## Research}
\NormalTok{lambda1_vals_sim <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(lambda1_vals, }\ControlFlowTok{function}\NormalTok{(x)  }\KeywordTok{rnorm}\NormalTok{(nsims, }\DataTypeTok{mean =}\NormalTok{ x, }\DataTypeTok{sd =} \FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{x) )}
\NormalTok{lambda2_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, lambda2_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{lambda2_val)}
\NormalTok{q_full_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, q_full_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{q_full_val)}

\CommentTok{## Guess work}
\NormalTok{periods_val <-}\StringTok{ }\DecValTok{50}           \CommentTok{#Total number of periods to forecast wages}
\NormalTok{time_to_jm_val <-}\StringTok{ }\DecValTok{10}        \CommentTok{#Time from intial period until individual join the labor force}
\NormalTok{coef_exp_val_sim <-}\StringTok{  }\KeywordTok{sapply}\NormalTok{(coef_exp_val, }\ControlFlowTok{function}\NormalTok{(x)  }\KeywordTok{rnorm}\NormalTok{(nsims, }\DataTypeTok{mean =}\NormalTok{ x, }\DataTypeTok{sd =} \FloatTok{0.001}\NormalTok{))}
\NormalTok{teach_sal_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, teach_sal_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{teach_sal_val)}
\NormalTok{teach_ben_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, teach_ben_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{teach_ben_val)}
\NormalTok{n_students_val_sim <-}\StringTok{ }\KeywordTok{rnorm}\NormalTok{(nsims, n_students_val, }\FloatTok{0.1} \OperatorTok{*}\StringTok{ }\NormalTok{n_students_val)}

\NormalTok{delta_ed_vals_sim <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(delta_ed_vals[,}\DecValTok{1}\NormalTok{], }\ControlFlowTok{function}\NormalTok{(x)  }\KeywordTok{rnorm}\NormalTok{(nsims, }\DataTypeTok{mean =}\NormalTok{ x, }\DataTypeTok{sd =} \KeywordTok{sd}\NormalTok{(delta_ed_vals[,}\DecValTok{1}\NormalTok{])))}
\KeywordTok{colnames}\NormalTok{(delta_ed_vals_sim) <-}\StringTok{ }\DecValTok{1999}\OperatorTok{:}\DecValTok{2007}

\NormalTok{delta_ed_ext_vals_sim <-}\StringTok{ }\KeywordTok{sapply}\NormalTok{(delta_ed_ext_vals[,}\DecValTok{1}\NormalTok{], }\ControlFlowTok{function}\NormalTok{(x)  }\KeywordTok{rnorm}\NormalTok{(nsims, }\DataTypeTok{mean =}\NormalTok{ x, }\DataTypeTok{sd =} \KeywordTok{sd}\NormalTok{(delta_ed_ext_vals[,}\DecValTok{1}\NormalTok{])))}
\KeywordTok{colnames}\NormalTok{(delta_ed_ext_vals_sim) <-}\StringTok{ }\DecValTok{1999}\OperatorTok{:}\DecValTok{2007}

\NormalTok{npv_sim <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\OtherTok{NA}\NormalTok{, nsims)}
\CommentTok{#yes externality NPV}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\OperatorTok{:}\NormalTok{nsims) \{}
\NormalTok{  interst_r_val <-}\StringTok{ }\NormalTok{gov_bonds_sim[i] }\OperatorTok{-}\StringTok{ }\NormalTok{inflation_sim[i]}
\NormalTok{  wage_}\DecValTok{0}\NormalTok{_val <-}\StringTok{ }\KeywordTok{wage_0_f}\NormalTok{(}\DataTypeTok{wage_ag =}\NormalTok{ wage_ag_val_sim[i], }
                       \DataTypeTok{wage_ww =}\NormalTok{ wage_ww_val_sim[i], }
                       \DataTypeTok{profits_se =}\NormalTok{ profits_se_val_sim[i], }
                       \DataTypeTok{hours_se_cond =}\NormalTok{ hours_se_cond_val_sim[i], }
                       \DataTypeTok{hours_ag =}\NormalTok{ hours_ag_val_sim[i], }
                       \DataTypeTok{hours_ww =}\NormalTok{ hours_ww_val_sim[i], }
                       \DataTypeTok{hours_se =}\NormalTok{ hours_se_val_sim[i], }
                       \DataTypeTok{ex_rate =}\NormalTok{ ex_rate_val_sim[i])  }
\NormalTok{  experience_val <-}\StringTok{ }\DecValTok{0}\OperatorTok{:}\NormalTok{periods_val }\OperatorTok{-}\StringTok{ }\NormalTok{time_to_jm_val}
\NormalTok{  wage_t_val <-}\StringTok{ }\KeywordTok{wage_t}\NormalTok{(}\DataTypeTok{wage_0 =}\NormalTok{ wage_}\DecValTok{0}\NormalTok{_val, }
                   \DataTypeTok{growth_rate =}\NormalTok{ growth_rate_val_sim[i], }
                   \DataTypeTok{experience =}\NormalTok{ experience_val, }
                   \DataTypeTok{coef_exp1 =}\NormalTok{ coef_exp_val_sim[i,}\DecValTok{1}\NormalTok{], }
                   \DataTypeTok{coef_exp2 =}\NormalTok{ coef_exp_val_sim[i,}\DecValTok{2}\NormalTok{])}
\NormalTok{  lambda1_vals_aux <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(}\FloatTok{0.5} \OperatorTok{*}\StringTok{ }\NormalTok{lambda1_vals_sim[i,}\DecValTok{1}\NormalTok{] }\OperatorTok{+}\StringTok{ }\FloatTok{0.5} \OperatorTok{*}\StringTok{ }\NormalTok{lambda1_vals_sim[i,}\DecValTok{2}\NormalTok{], }\DecValTok{2}\NormalTok{)}
\NormalTok{  lambda2_vals <-}\StringTok{ }\KeywordTok{rep}\NormalTok{(lambda2_val_sim[i], }\DecValTok{2}\NormalTok{)}
\NormalTok{  coverage_val_aux <-}\StringTok{  }\NormalTok{saturation_val_sim[i] }\OperatorTok{/}\StringTok{ }\NormalTok{full_saturation_val_sim[i]}
\NormalTok{  saturation_val_aux <-}\StringTok{ }\NormalTok{full_saturation_val_sim[i] }\OperatorTok{*}\StringTok{ }\NormalTok{coverage_val_sim[i]}
\NormalTok{  cost_per_student <-}\StringTok{ }\NormalTok{(teach_sal_val_sim[i] }\OperatorTok{+}\StringTok{ }\NormalTok{teach_ben_val_sim[i]) }\OperatorTok{/}\StringTok{ }\NormalTok{n_students_val_sim[i]}
\NormalTok{  q2_val_aux <-}\StringTok{ }\NormalTok{q_full_val_sim[i]}
\NormalTok{  s2_val_aux <-}\StringTok{ }\NormalTok{( unit_cost_local_val_sim[i] }\OperatorTok{/}\StringTok{ }\NormalTok{ex_rate_val_sim[i] ) }\OperatorTok{*}\StringTok{ }\NormalTok{years_of_treat_val_sim[i]}
\NormalTok{  delta_ed_ext_total_sim <-}\StringTok{ }\NormalTok{delta_ed_vals_sim[i,] }\OperatorTok{+}\StringTok{ }\NormalTok{delta_ed_ext_vals_sim[i,]}
 
\NormalTok{  include_ext <-}\StringTok{ }\OtherTok{TRUE}
  \ControlFlowTok{if}\NormalTok{ (include_ext}\OperatorTok{==}\OtherTok{TRUE}\NormalTok{)\{}
\NormalTok{    delta_ed_final <-}\StringTok{  }\NormalTok{delta_ed_ext_total_sim}
\NormalTok{  \}}\ControlFlowTok{else}\NormalTok{\{}
\NormalTok{    delta_ed_final <-}\StringTok{ }\NormalTok{delta_ed_vals_sim[i,]}
\NormalTok{  \}}
  
\NormalTok{  npv_sim[i] <-}\StringTok{ }\KeywordTok{npv}\NormalTok{(}\DataTypeTok{interest_r =}\NormalTok{ interst_r_val, }
                     \DataTypeTok{wage =}\NormalTok{ wage_t_val, }
                     \DataTypeTok{lambda1_male =}\NormalTok{ lambda1_vals_aux[}\DecValTok{1}\NormalTok{], }
                     \DataTypeTok{lambda1_female =}\NormalTok{ lambda1_vals_aux[}\DecValTok{2}\NormalTok{], }
                     \DataTypeTok{lambda2_male =}\NormalTok{  lambda2_vals[}\DecValTok{1}\NormalTok{], }
                     \DataTypeTok{lambda2_female =}\NormalTok{  lambda2_vals[}\DecValTok{2}\NormalTok{],}
                     \DataTypeTok{coverage =}\NormalTok{ coverage_val_aux,}
                     \DataTypeTok{saturation =}\NormalTok{ saturation_val_aux,}
                     \DataTypeTok{tax =}\NormalTok{ tax_val_sim[i], }
                     \DataTypeTok{cost_of_schooling=}\NormalTok{cost_per_student, }
                     \DataTypeTok{delta_ed_male =}\NormalTok{ delta_ed_final, }
                     \DataTypeTok{delta_ed_female =}\NormalTok{ delta_ed_final, }
                     \DataTypeTok{q2 =}\NormalTok{ q2_val_aux, }
                     \DataTypeTok{s2 =}\NormalTok{ s2_val_aux)}
\NormalTok{\}}

\CommentTok{# unit test}
\ControlFlowTok{if}\NormalTok{ (}\KeywordTok{abs}\NormalTok{(}\KeywordTok{sd}\NormalTok{(npv_sim) }\OperatorTok{-}\StringTok{ }\FloatTok{30.5607}\NormalTok{)}\OperatorTok{>}\FloatTok{0.0001}\NormalTok{ ) \{}
  \KeywordTok{print}\NormalTok{(}\StringTok{"Output has change"}\NormalTok{)}
\NormalTok{\}}

\NormalTok{npv_for_text <-}\StringTok{ }\KeywordTok{paste}\NormalTok{(}\StringTok{"Median NPV:}\CharTok{\textbackslash{}n}\StringTok{ "}\NormalTok{, }\KeywordTok{round}\NormalTok{(}\KeywordTok{median}\NormalTok{(npv_sim), }\DecValTok{2}\NormalTok{))}
\KeywordTok{ggplot}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_density}\NormalTok{(}\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ npv_sim,}
                   \DataTypeTok{alpha =} \DecValTok{1}\OperatorTok{/}\DecValTok{2}\NormalTok{), }\DataTypeTok{kernel =} \StringTok{"gau"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_vline}\NormalTok{(}\DataTypeTok{xintercept =} \KeywordTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\KeywordTok{median}\NormalTok{(npv_sim)), }\DataTypeTok{col=}\StringTok{"blue"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{coord_cartesian}\NormalTok{(}\DataTypeTok{xlim =} \KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{30}\NormalTok{,}\DecValTok{100}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{guides}\NormalTok{(}\DataTypeTok{alpha =} \StringTok{"none"}\NormalTok{, }\DataTypeTok{colour=}\StringTok{"none"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{labs}\NormalTok{(}\DataTypeTok{y =} \OtherTok{NULL}\NormalTok{,}
       \DataTypeTok{x =} \StringTok{"NPV"}\NormalTok{ ,}
       \DataTypeTok{title =} \StringTok{"Distribution NPV of Fiscal Impacts of Deworming"}\NormalTok{, }
       \DataTypeTok{subtitle =} \StringTok{"With Externalities"}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{annotate}\NormalTok{(}\StringTok{"text"}\NormalTok{, }\DataTypeTok{x =} \FloatTok{2.2} \OperatorTok{*}\StringTok{ }\KeywordTok{median}\NormalTok{(npv_sim), }\DataTypeTok{y =} \FloatTok{0.012}\NormalTok{, }\DataTypeTok{label =}\NormalTok{ npv_for_text, }\DataTypeTok{size =} \DecValTok{6}\NormalTok{)}\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}\DataTypeTok{axis.ticks =} \KeywordTok{element_blank}\NormalTok{(), }\DataTypeTok{axis.text.y =} \KeywordTok{element_blank}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\includegraphics{01_test_dd_files/figure-latex/sa-1.pdf}

\hypertarget{sensitivity-analysis}{%
\subsection{Sensitivity Analysis}\label{sensitivity-analysis}}

Describe how we can move each component. Link to shiny app.

If we combinde all the subcomponents of equation 1 into on single, very
large, expression, we obtain:

\begin{equation}
THE\quad MONSTER\quad HERE
\end{equation}

\hypertarget{additional-documentation}{%
\subsection{Additional documentation}\label{additional-documentation}}

\hypertarget{questions-for-michael-ted-or-grace}{%
\subsection{Questions (for Michael, Ted or
Grace)}\label{questions-for-michael-ted-or-grace}}

\begin{itemize}
\tightlist
\item
  where are the \(N_\lambda\) in the spreadsheet?
\item
  To me: should I add small output after each subsection?
\item
  What are the terms behind the calculation of \(R\)?
\item
  Clarify circularity behing \(R\) and \(p\)
\item
  Why \(\Delta \overline{E}_{\gamma t}(S1,S2)\) is not used for separate
  groups (men and female)
\end{itemize}

\hypertarget{next-steps}{%
\subsection{Next steps:}\label{next-steps}}

\begin{itemize}
\tightlist
\item
  set up each primitive parama as normal(value,sd = something). DONE
\item
  run 1000? 10000? times and obtain figure 1. DONE
\item
  Finish description of last component. DONE
\item
  deploy shiny app with one slider. DONE

  \begin{itemize}
  \tightlist
  \item
    wrap everything in a horrible function DONE
  \item
    add aditional sliders DONE
  \end{itemize}
\item
  Display value for NPV
\item
  reproduce results with and without externalities reactively
\end{itemize}


\end{document}
