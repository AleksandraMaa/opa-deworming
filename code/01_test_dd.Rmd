---
title: "Dynamic Document for Fiscal Impacts of Deworming"
output:
  html_document:
    code_folding: hide
editor_options: 
  chunk_output_type: console
---
\def\blue{\color{blue}}


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r paramters}
## Data 
gov_bonds <- 	0.1185	    #Kenyan interest on sovereign debt (Central Bank of Kenya)
inflation <-  0.02        #Kenyan inflation rate (World Bank Development Indicators)
interst_r_val <- gov_bonds - inflation
# Discount Rate	0.0985	(sovereign - inflation)

#Deworming Cost per person per year (KSH)	43.66	Deworm the World

## Guess work


## Research


```

    

## Who are the policy makers?
 - Ministries of Health, Education and Finance. 

## What is the relevant output that should be used to inform them?
 - NPV
 
## Proposed output:    
 
 
```{r sample-output, echo=FALSE, warning=FALSE, message=FALSE}
set.seed(1234)
library(tidyverse)

ggplot() +
  geom_density(aes(x = rnorm(1000, mean = 1),
                   alpha = 1/2), bw=.11, kernel = "gau") +
  geom_vline(xintercept = c(0, 1), col="blue") +
  coord_cartesian(xlim = c(-3,3)) +
  scale_x_discrete(limits = c(0,1))  +   
  guides(alpha = "none", colour="none") +
  labs(y = NULL,
       x = "NPV" ,
       title = "Figure 1: Distribution NPV of Fiscal Impacts of Deworming")+
  theme(axis.ticks = element_blank(), axis.text.y = element_blank())
```
 
## Main Equation (the model)

\begin{equation}
NPV =  \sum_{\gamma} N_{\gamma} \left[ 
\tau \sum_{t=0}^{50} \left( \frac{1}{1 + r}\right)^{t} w_{t} 
\left( \lambda_{1, \gamma} + \frac{p \lambda_{2, \gamma}}{R} \right) - 
K \sum_{t=0}^{50} \left( \frac{1}{1 + r}\right)^{t} \Delta \overline{E}_{\gamma t}(S1,S2)
\right] - \left( S_{2}Q(S_{2}) - S_{1}Q(S_{1}) \right)
\label{eq:1}
\tag{1}
\end{equation}


```{r model}

# Gamma is used to index gender. 
npv <- function(n_male=1, n_female=1, 
                interest_r_f=interst_r_val, 
                wage=1, lambda1_male=1,
                lambda1_female=1, 
                tax=0.16575, 
                saturation=1, coverage=1, cost_of_schooling=1, 
                delta_ed_male=1, delta_ed_female=1, lambda2_male=1, lambda2_female=1, 
                s1=1, q1=1, s2=1, q2=1, periods=50) {
  ns <- c(n_male, n_female)
  lambda1s <- c(lambda1_male, lambda1_female)
  lambda2s <- c(lambda2_male, lambda2_female)
  index_t <- 1:periods
  delta_ed_s <- c(delta_ed_male, delta_ed_female)
  
  res1 <- sum( ns * (
          tax * sum( ( 1 / (1 + interest_r) )^index_t * wage * 
                     ( lambda1s + saturation * lambda2s / coverage ) ) - 
          cost_of_schooling * sum( ( 1 / (1 + interest_r) )^index_t * 
                                    delta_ed_s )
          )
          ) - (s2 * q2  - s1 * q1) 
  return(res1)  
}
```


## Sub components: 

### "$r$"

\begin{equation}
NPV =  \sum_{\gamma} N_{\gamma} \left[ 
\tau \sum_{t=0}^{50} \blue{\left(  \frac{1}{1 + r}\right)}^{t} w_{t} 
\left( \lambda_{1, \gamma} + \frac{p \lambda_{2, \gamma}}{R} \right) - 
K \sum_{t=0}^{50} \blue{\left( \frac{1}{1 + r}\right)}^{t} \Delta \overline{E}_{\gamma t}(S1,S2)
\right] - \left( S_{2}Q(S_{2}) - S_{1}Q(S_{1}) \right)
\end{equation}

The real interest rate $r$ is obtained from the interest rate on goberment bonds (`r round(gov_bonds, 3)`) minus the inflation rate (`r inflation`). 

```{r real-int-rate}
interst_r_val <- gov_bonds - inflation
```


### "$w_{t}$"

\begin{equation}
NPV =  \sum_{\gamma} N_{\gamma} \left[ 
\tau \sum_{t=0}^{50}\left(  \frac{1}{1 + r}\right)^{t} \blue{ w_{t} }
\left( \lambda_{1, \gamma} + \frac{p \lambda_{2, \gamma}}{R} \right) - 
K \sum_{t=0}^{50} \left( \frac{1}{1 + r}\right)^{t} \Delta \overline{E}_{\gamma t}(S1,S2)
\right] - \left( S_{2}Q(S_{2}) - S_{1}Q(S_{1}) \right)
\end{equation}


\begin{equation}
w_t =  \text{#weeks} \times w_0 (1 + g)^{Xp}(1 + \hat{\beta_1} Xp + \hat{\beta_2} Xp^2)
\end{equation}

Wage at time $t$ is the weekely starting wage in USD ($w_0$) that has a base growth rate equal to the per capita GDP growth ($g$) applied to however many years of work ($Xp$). In addition to this growth, the salaries are adjusted to represent a (concave) wage life cycle profile ($1 + \hat{\beta_1} Xp + \hat{\beta_2} Xp^2$).

#### "$w_0$"

\begin{equation}
w_t =  \text{#weeks} \times \blue{w_0} (1 + g)^{Xp}(1 + \hat{\beta_1} Xp + \hat{\beta_2} Xp^2)
\end{equation}

\begin{equation}
w_0 = \frac{1}{ex} \sum_{l \in \{ag, ww, se\}}w_{l}\alpha_{l} 
\end{equation}

 **Question**: hrs ag = Assumps&Panel A Calcs B25 - still not sure how it came from table 4 (no panel D and ) 

      - Mean starting wage (KSh) = Ag wage (Suri, 2011) * share of hrs in ag + working wage * share of hrs working for wages + self-emp wage * share of hours in self-emp
        - share of hrs in ag = Control hrs per week, agriculture/(agric + working for wages+ self-employment) AQUI VOY
        - share of hrs in ag ...
        - share of hrs in self-emp ...
        - working wage = Control group hourly wage, working for wages (conditional on >=10 hrs per week)
        - self-emp wage = Monthly self-employed profits/(4.5*weekly self-employed hrs, cond hrs>0)
          - Monthly self-employed profits = Control group monthly self-employed profits
          - weekly self-employed hrs, cond hrs>0) = Control group weekly self-employed hours, conditional on hrs >0

```{r wage_t, eval=FALSE}
wage_t

wage_0
```


### "$\lambda_{1,\gamma}$"

\begin{equation}
NPV =  \sum_{\gamma} N_{\gamma} \left[ 
\tau \sum_{t=0}^{50}\left(  \frac{1}{1 + r}\right)^{t} w_{t} 
\left(\blue{ \lambda_{1, \gamma} } + \frac{p \lambda_{2, \gamma}}{R} \right) - 
K \sum_{t=0}^{50} \left( \frac{1}{1 + r}\right)^{t} \Delta \overline{E}_{\gamma t}(S1,S2)
\right] - \left( S_{2}Q(S_{2}) - S_{1}Q(S_{1}) \right)
\end{equation}

## Additinal documentation


## Questions (for Michael, Ted or Grace)

- where are the $M_\lambda$ in the spreadsheet?
- 